# Функциональный блок "Таблица рецептов MBE" (MbeTableFB)

**MbeTableFB** — это гибкий функциональный блок для **MasterSCADA 3.12**, предназначенный для создания, управления и исполнения технологических рецептов.

![MbeTableFB](MbeTableFB.png)

## Оглавление

- [Конфигурация через YAML-файлы](./ModuleConfig/readme.md)
- [Взаимодействие с ПЛК по Modbus TCP](./ServiceModbusTCP/readme.md)
- [Импорт и экспорт рецептов в CSV](./ServiceCsv/readme.md)
- [Пины функционального блока (FB Pins)](./ModuleInfrastructure/readme.md)
- [Диагностика](./ServiceLogger/readme.md)

## 1. Ключевые возможности

- Гибкая настройка: Вся бизнес-логика, структура таблицы и набор команд определяются в текстовых YAML-файлах.
- Динамический интерфейс: Пользовательский интерфейс (столбцы, редакторы, выпадающие списки) генерируется автоматически на основе конфигурации.
- Мониторинг в реальном времени: Отслеживание исполнения рецепта, подсветка текущего шага и расчет оставшегося времени до конца шага и рецепта.
- Интеграция с ПЛК: Прямое взаимодействие с контроллерами по протоколу Modbus TCP для записи параметров рецепта.
- Динамическое создание пинов: Пины для связи с оборудованием создаются автоматически на основе файла `PinGroupDefs.yaml`.

## 2. Требования к окружению

- Среда исполнения: MasterSCADA 3.12.
- Зависимости: .NET Framework 4.8.

## 3. Установка и первоначальная настройка

1. Установка библиотеки:
    - Скопируйте библиотеку `NtoLib.dll` и `System.Resources.Extensions.dll` в корневую папку установки MasterSCADA.
    - Зарегистрируйте сборку с помощью утилиты `netreg.exe`.
2. Создание папки конфигурации:
    - В корневой директории, где установлена MasterSCADA, создайте папку с именем `NtoLibTableConfig`.
3. Размещение конфигурационных файлов:
    - Поместите в папку `NtoLibTableConfig` четыре обязательных YAML-файла (готовые темплейты для проектов можно найти по [ссылке](https://github.com/Semiteq/NtoLib/tree/master/NtoLib/Recipes/MbeTable/YamlTemplates)):
        - `PropertyDefs.yaml`
        - `PinGroupDefs.yaml`
        - `ColumnDefs.yaml`
        - `ActionsDefs.yaml`
4. Добавление блока в проект:
    - Перезапустите среду разработки MasterSCADA.
    - Добавьте функциональный блок "Таблица рецептов MBE" на схему в вашем проекте.

## Поведение при загрузке

- Загрузка конфига стартует либо по клику объекта в дереве (т.к. нужно отобразить пины), либо по переходу на экран с объектом (смотря что произойдет раньше).
- Для повторной загрузки нужно перезапустить MasterSCADA, чтобы инициировать объект заново.