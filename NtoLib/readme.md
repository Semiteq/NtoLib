# Библиотека NtoLib

Библиотека пользовательских функциональных блоков и инфраструктуры для **MasterSCADA 3.12** (.NET Framework 4.8), используется на установках эпитаксии, плазмохимии и смежных системах.

## Модули и документация

### ConfigLoader

Функциональный блок загрузки/сохранения именованных настроек оборудования (заслонки, источники, нагреватели, вода, газовые линии) из YAML‑файла конфигурации.

- Документация: [`ConfigLoader`](./ConfigLoader/readme.md)

### TrendPensManager

Функциональный блок автоматизации настройки трендов: добавляет перья на графики на основе структуры сервисов под `DataRootPath` и имён из ConfigLoader, с автоматическим применением стиля отображения "ступенькой".

- Документация: [`TrendPensManager`](./TrendPensManager/readme.md)

### Таблица рецептов MBE (MbeTable)

Функциональный блок для конфигурации, редактирования и исполнения технологических рецептов в MasterSCADA.

- Документация на блок: [`MbeTable`](./MbeTable/readme.md)
- Модули блоков:
    - Конфигурация через YAML: [`ModuleConfig`](./MbeTable/ModuleConfig/readme.md)
    - Работа с пинами SCADA: [`ModuleInfrastructure`](./MbeTable/ModuleInfrastructure/readme.md)
    - UI/UX и взаимодействие: [`ModulePresentation`](./MbeTable/ModulePresentation/readme.md)
    - Импорт/экспорт CSV: [`ServiceCsv`](./MbeTable/ServiceCsv/readme.md)
    - Взаимодействие с ПЛК по Modbus TCP: [`ServiceModbusTCP`](./MbeTable/ServiceModbusTCP/readme.md)
    - Диагностика и логирование: [`ServiceLogger`](./MbeTable/ServiceLogger/readme.md)

### BrokenLinksObserver

Функциональный блок поиска оборванных связей между пинами в дереве объектов. Используется для быстрой диагностики проектов перед релизом: находит пины с отсутствующими источниками/приёмниками и помогает не возить в инсталляцию "битые" схемы.

### ClockGenerator

Функциональный блок инкремента по времени. Формирует программный таймер для шаговых/циклических операций, где требуется надёжный счётчик времени, отвязанный от конкретного контроллера.

### PumpFB

Визуальный функциональный блок для отображения и управления насосами. Даёт типовой HMI‑виджет с индикацией состояния, аварий и базовыми командами пуска/остановки.

### ValveFB

Визуальный функциональный блок для отображения и управления клапанами и шиберами. Используется как стандартный элемент интерфейса для байпасов, запорных и регулирующих органов с типовым набором состояний.

### TexBoxFloatFB и TextBoxIntFB

Визуальные функциональные блоки для контроля ввода пользовательских числовых данных с ограничением Min/Max. Обеспечивают проверку диапазонов и формата ввода прямо на уровне блока.

### SpectrometerFB

Невизуальный функциональный блок для работы со спектрометром ATP2000P. Инкапсулирует протокол обмена и выдаёт в SCADA уже разобранные/нормализованные данные измерений.

## Avoid The Following

- В легаси FB **нельзя** менять неймспейс FB, которые уже присутствуют в старых проектах. MasterScada кеширует объекты. Если в новой версии FB из dll отличается namespace FB блока в проекте - он не загрузится. Например, нельзя поменять NtoLib/Recipes/MbeTableFB -> NtoLib/MbeTableFB

- В легаси FB **нельзя** менять тип пинов блока (те, что объявляются в не визуальном классе), например, в MbeTableFB нельзя поменять uint -> int по той же причине, блок не загрузится.

Рекомендуется всё что возможно помечать как `[NonSerializable]`

---

Более подробную документацию по разработке блоков под MasterScada 3.12 можно найти в отдельном [репозитории](https://github.com/Semiteq/MasterScada3Wiki).
