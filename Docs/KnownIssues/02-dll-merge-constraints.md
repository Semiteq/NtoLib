# Ограничения сборки DLL для COM-плагинов MasterSCADA

## Описание проблемы

При поставке библиотеки в виде плагина/COM-компонента, загружаемой сторонним хостом (MasterSCADA), стратегия "один файл" может ломать загрузку зависимостей в рантайме.

## Costura (Fody.Costura) -- не использовать

- Costura опирается на `AssemblyResolve` и загрузку зависимостей из embedded resources.
- В MasterSCADA загрузка/активация типа происходит так рано или в таком контексте, что резолвер не срабатывает. Результат -- падение ещё на этапе создания объекта (до пользовательского кода и логирования) с симптомами отсутствия зависимостей.
- В MasterSCADA нет логов, позволяющих диагностировать проблему.
- Costura не позволяет запаковать и вызвать некоторые зависимости (предположительно `Serilog`). Конкретные ограничения дополнительно не проверялись.

**Вывод: Costura не использовать в этом проекте.**

## ILRepack -- текущий подход

ILRepack работает, но с ограничениями:

- Некоторые DLL (например `System.Resources.Extensions.dll` и другие, связанные с ресурсами/специальной загрузкой) не будут корректно работать при упаковке через ILRepack.
- Для таких DLL требуется отдельная доставка рядом с основной библиотекой (без merge).

## Правила сборки

1. **Всегда исключать vendor/host assemblies** из упаковки и поставки:
   - `MasterSCADA*.dll`
   - `FB.dll`
   - `InSAT.*.dll`
   - `ICSharpCode.*.dll`
   - Любые другие сборки, предоставляемые хостом MasterSCADA.
   Они берутся из окружения хоста.

2. **Использовать ILRepack по маске `*.dll` с явными исключениями.** Merge собирает все NuGet-зависимости в единую `NtoLib.dll`.

3. **Известные "не-mergeable" зависимости доставлять отдельно** рядом с основной DLL.

4. **Придерживаться принципа наименьшего количества файлов** в поставке.
