# NumericBox -- Поле ввода числового значения

> **TL;DR:** Визуальный ФБ для ввода и отображения числового значения. Работает через обратную связь с внешним источником. Отправляет в Pout пользовательский ввод или ввод от внешнего источника, в зависимости от того что новее. Работает через debounce значения для устранения глитча. Поддерживает блокировку ввода, диапазонную валидацию с предупреждениями MasterSCADA и настраиваемый формат отображения и вывода.

![](img/NumericBox-1.png)

## 1. Интерфейс

### Входы

| Имя | Тип | Описание |
|-----|-----|----------|
| Input | Вещественный | Внешнее значение (обратная связь от контура управления) |
| Lock | Логический | `true` -- блокировка ввода с визуальной индикацией |

![](img/NumericBox-2.png)

### Группа RangeLimits

| Имя | Тип | Описание |
|-----|-----|----------|
| MaxValue | Вещественный | Верхняя граница допустимого диапазона |
| MinValue | Вещественный | Нижняя граница допустимого диапазона |

Пины MinValue и MaxValue опциональны. Если пин не подключён (нет связи в дереве проекта), соответствующая граница не проверяется вне зависимости от значения.

### Выходы

| Имя | Тип | Описание |
|-----|-----|----------|
| Output | Вещественный | Выходное значение |

### События (Warnings)

| Имя | Условие |
|-----|---------|
| Значение выше максимума | Output > MaxValue (при подключённом MaxValue) |
| Значение ниже минимума | Output < MinValue (при подключённом MinValue) |
| Минимум превышает максимум | MinValue > MaxValue (при обоих подключённых) |

События активируются и деактивируются автоматически при каждом цикле `UpdateData`. Первые 5 секунд после перехода в Runtime события не генерируются.

## 2. Визуальные свойства (окно настроек)

| Свойство | По умолчанию | Описание |
|----------|--------------|----------|
| Цвет границы | SystemColors | Цвет рамки вокруг контрола |
| Толщина границы | 1 | Ширина рамки в пикселях (0 = без рамки) |
| Блокировка ввода | false | Принудительная блокировка (дополнительно к пину Lock) |
| Цвет разблокированного | White | Фон текстового поля в разблокированном состоянии |
| Цвет заблокированного | LightYellow | Фон текстового поля в заблокированном состоянии |
| Текст до | (пусто) | Префикс перед числом (например, `T =`) |
| Текст после | (пусто) | Суффикс после числа (например, `°C`) |
| Выравнивание | Left | Горизонтальное выравнивание текста |
| Жирный шрифт | true | Использовать жирное начертание |
| Формат отображения | TwoDecimals | Формат числа (см. ниже) |
| Режим размера шрифта | Auto | Auto -- подбор по высоте, Fixed -- фиксированный размер |
| Фиксированный размер шрифта | 12 | Размер в pt (действует только при режиме Fixed) |

![](img/NumericBox-3.png)

### Форматы отображения (DisplayFormat)

- `NoDecimals` -- целое число
- `OneDecimal` -- 1 знак после запятой
- `TwoDecimals` -- 2 знака после запятой
- `ThreeDecimals` -- 3 знака после запятой

## 3. Валидация при вводе

При подтверждении пользователем введённого значения (нажатие Enter / потеря фокуса):

1. **Парсинг**: попытка распознать число из текста. Точка заменяется на запятую. При ошибке -- `MessageBox` с описанием.
2. **Проверка диапазона**: если подключены пины MinValue / MaxValue, значение проверяется на вхождение в `[min, max]`. При выходе за границу -- `MessageBox` с указанием предела. Значение **отклоняется**, Output не изменяется.
3. **Применение**: при успешной валидации значение передаётся в Output.

Значения, приходящие через пин Input, **не** проверяются диапазоном на уровне валидации. Вместо этого при отклонении от диапазона генерируются предупреждающие события.


